---
title: "NFL Assignment"
#author: "ANONYMOUS (Keep it this way)"
date: "`r Sys.Date()`"
output: pdf_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
library( tidyverse )
library(scales)
knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    message = FALSE
    )

#Read in the data, note that we define several values in the original dataset as NA
nfl <- read_csv( "data/NFL-Census-Data-9.2.2013_clean.csv", 
                 na = c("NA","N/A","", "n/a", "#VALUE!") )

```

# Data Exploration

# 1. Highest and lowest salary in the dataset.

The highest salary is \$20,100,000 and the lowest salary is \$48,333.

```{r}
# Highest salary
max(nfl$Salary, na.rm = TRUE)

# Lowest salary
min(nfl$Salary, na.rm = TRUE)
```

\newpage

# 2. College and state for the five best paid players of the San Francisco 49ers.

The five best paid players' colleges of the San Francisco 49ers are: Mississippi, Auburn, Maryland, Penn State, and Miami (Fla.), and their states are Tennessee, Georgia, DC, Maryland, and Florida for states.

```{r}

nfl %>% 
    filter( Team == "SF" )  %>% 
    arrange( desc( Salary ) ) %>% 
    select( "Player Name", College, State ) %>% 
    head(5)
```

\newpage

# 3. Mean salary and number of players in the dataset for each position, sorted from highest to lowest mean salary.

```{r}

# Create a cleaned dataframe with NAs removed from Salary column

clean.dat <- nfl %>% 
    filter( !is.na( Salary ) )

clean.dat %>% 
    group_by( Position ) %>% 
    summarise( mean_salary = mean( Salary ), count = n() ) %>% 
    arrange( desc( mean_salary ) )

```

\newpage

# 4. Determine if taller players get paid more

Notes on our model: When fitting a model to understand whether height is associated with salary, it’s usually better to treat both salary and height as continuous numeric variables.
In the current model and plot, height is treated as a categorical variable, which makes the interpretation of the height–salary relationship more complicated.
The plot doesn't communicate much, as the categorical variables were sorted into alphabetical order, not according to their magnitude.

With the model using categorical variables, we have the height 5'10 set as the intercept, meaning that we estimate that players with that height will make on average US\$1,121,370, while players whose height is 6'2" and above will have higher salaries than the shorter players. However, none of these coefficients are statistically significant, apart from the players measuring 6'7" ($t$(d = 1730) = 2.18, $p$\<0.05), who will on average make 1.5 times more than the players measuring 5'10.

```{r}
# Add logSal variable and clean up a data point with a typo

clean.dat <- clean.dat %>%
    mutate( logSal = log( Salary), Height = if_else(Height == "6;2/;", "6'2\"", Height ) )


model <- lm( logSal ~ Height, data = clean.dat )
summary( model )
exp( coef( model ) )

```

\newpage

# 5. Improve the linear model

### Adding Position as a control variable

After adding Position as a covariate, we're left with no categories of height having a statistical significance, which means that according to this model, when controlling for position, no categories of height are associated with higher salaries (in terms of statistical significance).
The only position that shows a somewhat statistically significant relationship with log salary is tight end (TE).
$R^2$ increased from 0.002 to 0.015, in comparison with the previous model.
In other words, this model has a slightly better fit than the one with just height.
However, $R^2$ is still very small.

```{r}
# Create a new model that incorporates both Position and Height

model <- lm( logSal ~ Height + Position, data = clean.dat )
summary( model )
exp( coef( model ) )

```

\newpage

# 6. Mean weight and height for the football players, calculated for each position

Cleaning up the height variable and converting it into total inches, so that we can calculate the mean height for each position.

```{r}
# Convert height into total inches

clean.dat <- clean.dat %>%
    separate( Height, into = c("feet", "inches"), sep = "'" ) %>%
    mutate( feet = parse_number( feet ), 
            inches = parse_number( inches ), 
            total_inches = feet * 12 + inches )

clean.dat %>% 
    group_by( Position ) %>% 
    summarise( mean_weight = mean( Weight, na.rm = TRUE ), 
               mean_height = mean( total_inches, na.rm = TRUE ) ) 

```

\newpage

# Visualizations

## 7. Graph with 3 variables: X axis, Y axis, and plot point coloring, that tells a story.

We combined player positions to create three "Side" categories: "Offense", "Defense", and "Special Teams".

```{r}

clean.dat <- clean.dat %>%
    mutate( Side = case_when(
        Position %in% c("C", "FB", "OL", "QB", "RB", "TE", "WR") ~ "Offense",
        Position %in% c("CB", "DE", "DL", "LB", "NT", "S") ~ "Defense",
        Position %in% c("K", "LS", "P") ~ "Special Teams",
        TRUE ~ NA_character_
    ) )

# Plot with the new `Side` variable instead of `Position`
ggplot( clean.dat, aes( x = total_inches, y = logSal, color = Side ) ) +
    geom_point() +
    geom_smooth( method = "lm", se = FALSE ) +
    labs( title = "Log Salary vs Height by Position Side",
          x = "Height (inches)",
          y = "Log Salary" ) +
    theme(legend.position = "right")

```

\newpage

**7(B)**

Our plot shows how different sides of the game might have different relationships between height and salary.
The trend lines indicate that taller players who are on offense and defense make more money, while special teams players' salaries appear to be higher for shorter players.

\newpage

## 8. Graph with 4 variables that tells a story that our first plot does not.

Plot exploring how log salary, experience, race, and side (offense, defense, special teams) are related.

```{r}

# Remove NA from Race column

clean.dat <- clean.dat %>% 
    filter( !is.na( Race ) )

# Combine Asian/Pacific Islander and Pacific Islander into one category called
# Asian/Pacific Islander, and Iranian, Native American, and Other into one
# category called Other. 

clean.dat <- clean.dat %>%
  mutate(
    Race = if_else(
      Race == "Pacific Islander",
      "Asian/Pacific Islander",
      Race
    )
  ) %>%
  mutate(
    Race = if_else(
      Race %in% c("Native American", "Other", "Iranian"),
      "Other",
      Race
    )
  )

ggplot(clean.dat, aes(x = Experience, y = logSal, color = Race)) +
  geom_point(aes(shape = Side)) +  
  geom_smooth(method = "lm", se = FALSE) +        
  labs(
    title = "Log Salary vs Experience by Race and Side",
    x = "Experience (years)",
    y = "Log Salary",
    shape = "Side"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

```

**8(B)**

This plot shows that (as expected), salary increases with years of experience.
Hispanic, White, and Black show a similar trend, while Asian/Pacific Islander seems to show a steeper relationship (where salary increases more for each year of experience).
Other races show a very steep relationship, however, this is likely due to a small sample size rather than a statistically significant relationship.
It is difficult to tell from the graph if Side relates to the other variables, though it appears that potentially, offensive players make more money than others.
However, the graph is very busy and overly complicated.

\newpage

## 9. When might we prefer simpler plots with fewer moving pieces to more complicated plots?

The purpose of a plot is to convey information: often, certain types of information are better articulated visually than through words.
When making a plot, the user should always be kept in mind — what should they take away from the plot?
What is the intended message?
If a plot is too complicated and includes too many variables, this message can become obscured and difficult to understand.
Often, the most effective plots are simple and allow the user to intuitively understand what they are supposed to be taking away from the plot.
The plot above is overly complicated and makes it difficult to draw clear conclusions from the data.

\newpage

## 10. Multiple plots in the same window.

We modified our plot to see how years of experience, race, salary, and position are related, using facet wrap.

```{r}
# Using facet wrap, we broke out the data by Position (rather than Side).

ggplot( clean.dat, aes( x = Experience, y = logSal, color = Race ) ) +
    facet_wrap(~Position) +
    geom_point() +
    labs( title = "Log Salary and Years of Experience by Position and Race",
          x = "Experience (Years)",
          y = "Log Salary") +
    theme(legend.position = "bottom")


```

**10(B)**

This plot makes the data, and the conclusions we can draw from it, much clearer.
The color coding by race shows some very close relationships between race and position, and for many positions, there is a clear correlation between years of experience and log salary.
We can also see a relationship between position and years of experience — positions where players are injured more often (such as running back) show shorter career lengths than other positions.

\newpage

## 11. Log salary vs height by position.

For this plot, we used facet wrap to break out the data by position, and plotted log salary against height (in inches) for each position.
We also added a linear model line to show the relationship between height and log salary for each position.

```{r}
# Using facet wrap to break out the data by Position, and plotted log salary
# against height (in inches)

ggplot( clean.dat, aes( x = total_inches, y = logSal)) +
    facet_wrap(~Position) +
    geom_point() +
    geom_smooth( method = "lm", se = FALSE ) +
    labs( title = "Log Salary vs Height by Position",
          x = "Height (inches)",
          y = "Log Salary" ) +
    theme(legend.position = "bottom")

```

**11(B).**

Our plot shows that there appears to be a relationship between height and log salary for some positions, such as fullback, offensive lineman, and quarterback, but not for others.
The plot also shows that certain positions have a wider distribution of heights than others — wide receivers are of many heights, whereas all offensive linemen in the data set are tall.
We can also see that certain positions, such as quarterback, make more money on average than others.

\newpage

# A touch of modeling

## 12. Predictive model (using OLS) to predict log salary using experience, age, position.

Missing data: At first, when trying to fit the model, we used `na.action = na.omit` within the `lm()` function.
But R couldn't run the `predict()` function, because there was incompatibility with the number of rows (1743 x 1745).
So to ensure we were predicting the log salary of the same individuals, we decided to remove null values of the entire dataset within this specific chunk of code, using: `clean2 <- na.omit(clean.dat)` before fitting the model.

```{r}

# I was cleaning na when fitting the model, so I got an error saying: ! Can't
# recycle input of size 1743 to size 1745. Then ChatGPT suggested to clean the
# data before fitting the model.

clean2 <- na.omit(clean.dat)

model_final <- lm( 
  logSal ~ Experience + Age + Position, 
  data = clean2,
  na.action = na.omit)

clean2$pred_logSal <- predict(model_final)

summary( model_final )

```

\newpage

## 13. Plot showing predictions vs actual and a residual plot.

Using OLS, we created a model to predict log salary using experience, age, and position.

```{r}

clean2 <- clean2 %>%
  filter(complete.cases(Experience, Age, Position))

# the above line was suggested by chatgpt after failing to filter na in multiple
# variables.

# model predicted vs actual
ggplot( clean2, aes( x = predict( model_final ), 
                     y = logSal , color = Experience) ) +
    geom_point() +
    geom_abline( slope = 1, intercept = 0, col = "red" ) +
    labs( title = "Predictive Model of Log Salary: Predicted vs Actual",
        y = "Actual Log Salary", 
        x = "Predicted Log Salary" 
        )
```

\newpage

In order to evaluate the fit of our model, we created a residuals plot, which shows the residuals of the predicted log salary.

```{r}
# residuals plot
ggplot( clean2, aes( x = predict( model_final ), 
                     y = resid( model_final ), color = Experience ) ) +
    geom_point() +
    geom_smooth( method = "loess", se = FALSE ) +
    geom_hline( yintercept = 0, col = "red" ) +
    labs( 
        title = "Residuals of Predicted vs Actual Log Salary",
        x = "Predicted Log Salary",
        y = "Residuals" 
        )

```

```{r, eval=FALSE, include=FALSE}

# Some old code. If we coded this right, it shouldn't show up in the final 
# report.

# 1. Clean data for the model
model_dat <- clean.dat %>%
  filter(complete.cases(logSal, total_inches, Weight, Position, Age, Experience))

# 2. Fit model on *model_dat*
model_final <- lm(logSal ~ Position + Age + Experience,
                  data = model_dat)

# 3. Add predictions to *model_dat*
model_dat$pred <- predict(model_final)

# 4. Plot: guaranteed same rows, same order


ggplot(model_dat, aes(x = logSal, y = pred)) +
    scale_x_continuous(limits = c(12,17)) +
    scale_y_continuous(limits = c(12,17)) +
     labs(x = "Actual Log Salary", y = "Predicted Log Salary") +
  geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
   geom_abline(slope = 1, col = "red") 

# LB note: I added the reference line to show what the line of fit should look like if there is a 1:1 correlation between predicted and actual salary. However, there is not! The blue and red lines have very different slopes.

# above is the suggestion from chatgpt to make sure that I'm comparing the predictions to the actual values for the same set of observations, since the model is only trained on a subset of the data that has complete cases for all the variables.

# residuals plot

ggplot( clean.dat, aes( x = predict( model_final ), 
                        y = resid( model_final ) ) ) +
    geom_point() +
    #geom_smooth( method = "loess", se = FALSE ) +
    geom_hline( yintercept = 0, col = "red" ) +
    labs( x = "Predicted Log Salary", y = "Residuals" )



```

**13(B)**

The plot showing the relationship between predicted and actual salary does not show a good fit according to the linear model.
The residuals plot shows a slanted pattern, which also indicates that our model does not fit the data well (the residuals should be randomly clustered around zero).

\newpage

## 14. Distribution of the ages of players in the dataset.

We created a histogram to visualize the distribution of player ages, and calculated summary statistics to understand the central tendency and spread of the ages.

```{r}
# Histogram of player ages

clean.dat %>%
    ggplot( aes( x = Age ) ) +
    geom_histogram( binwidth = 1, fill = "lightblue", color = "black" ) +
    labs( title = "Distribution of Player Ages",
          x = "Age",
          y = "Count" )

# Let's use the 75th percentile to estimate the age of retirement for NFL players.

quantile( clean.dat$Age, probs = 0.75, na.rm = TRUE )

summary( clean.dat$Age, na.rm = TRUE)
    
```

If we take the 75% percentile as a possible indication of the age of retirement, this is estimated to be 30 years old.

**14(B).**

The average age of retirement in the NFL is roughly 27.6 years.
(Source: <https://runrepeat.com/nfl-player-career-length>)

Interestingly, this aligns almost exactly with the mean and median age in our dataset.
Would this have perhaps been a better way of estimating retirement age than using the 75% percentile?

\newpage

## 15. Prediction of average lifetime earnings for a median level pay NFL player

We calculated median lifetime salary by position, and then took a weighted average.

According to [statista.com](https://www.statista.com/statistics/240102/average-player-career-length-in-the-national-football-league/?srsltid=AfmBOoqmPYi5zkjXX6DnUkiD1QaxzctbS5JcTA_lbZ8tMZEYbO0MzTjS) the average career length for an NFL player is 3.3 years, but it varies by position.

First, we reconciled the positions from statista with the ones from our dataset.
With the help from ChatGPT, we clarified which sub-positions fall into the broader position categories (initials added to the list by us).

```{r}

table(clean.dat$Position)

# Not clearly indicated on the list from statista.com:
# C   DE   FB   LS  NT     S   
# Center, Defensive End, Fullback, Long Snapper, Nose Tackle, Safety

# List from statista.com, updated with missing positions based on ChatGPT's advice: 
# Kickers/punters (K, P, LS): 4.87 years
# Quarterbacks (QB): 4.44
# Offensive Linemen (OL, C): 3.63
# Defensive Linemen (DL, DE, NT): 3.24
# Linebackers (LB): 2.97
# Cornerbacks (CB, S): 2.94
# Tight Ends (TE): 2.85
# Wide receivers (WR): 2.81
# Running backs (RB, FB): 2.57
# Average across all positions: 3.3
```

Second, we created a new variable in our dataset that assigns the average career length to each player based on their position:

```{r}

clean.dat <- clean.dat %>%
    mutate( Career_Length = case_when(
        Position %in% c("K", "P", "LS") ~ 4.87,
        Position == "QB" ~ 4.44,
        Position %in% c("OL", "C") ~ 3.63,
        Position %in% c("DL", "DE", "NT") ~ 3.24,
        Position == "LB" ~ 2.97,
        Position %in% c("CB", "S") ~ 2.94,
        Position == "TE" ~ 2.85,
        Position == "WR" ~ 2.81,
        Position %in% c("RB", "FB") ~ 2.57,
        TRUE ~ NA_real_
    ) )

```

We, then, calculated the median salary for each position and put this data into a new data frame, position_earnings, that also includes the career length and count of players for each position.
We then created a new variable in this data frame, lifetime_earnings, which is the product of median salary and career length:

The average lifetime earnings for a median level pay NFL player would be approximately \$2,814,507.

```{r}

clean.dat %>% 
    group_by( Position ) %>% 
    summarise( median_salary = median( Salary, na.rm = TRUE ) ) 

# Put this data into a new data frame

position_earnings <- clean.dat %>%
    group_by( Position ) %>%
    summarise( median_salary = median( Salary, na.rm = TRUE ), 
               career_length = first( Career_Length ), 
               count = n() ) %>%
    mutate( lifetime_earnings = median_salary * career_length )


# Now we need a weighted average of lifetime earnings by position, based on the
# proportion of positions in the NFL dataset as a whole

position_earnings %>% 
    summarize(avg_lifetime = sum( (lifetime_earnings * count )/ sum( count )) )

```

\newpage

# Extension

### Compared with a **2024** dataset, we examine how salaries have changed and create visualizations to compare the two datasets. We also investigate differences in salary by position and experience level across the two datasets. (Note: we did not factor inflation into this analysis; correcting for inflation would be a logical next step). 

On average, players in 2024 are making \$578,365 per year more than players in 2013.

```{r}
nfl_24 <- read_csv( "data/Master-Player-List-2024.csv", 
                 na = c("NA","N/A","", "n/a", "#VALUE!") )

# Removing NAs from CapHit in 2024 dataset
clean.dat.24 <- nfl_24 %>% 
    filter( !is.na( CapHit ) )

# Creating Salary variable in 2024 dataset from CapHit
clean.dat.24 <- clean.dat.24 %>% 
    mutate( Salary = parse_number( CapHit ) )

# Finding the middle and average salary in both 2013 and 2024     
clean.dat %>% 
    filter( !is.na( Salary ) ) %>%
    summarise( mean_2013 = mean( Salary ), 
               median_2013 = median( Salary ) )
               
clean.dat.24 %>% 
    filter( !is.na( Salary ) ) %>%
    summarise( mean_2024 = mean( Salary ), 
               median_2024 = median( Salary ) )

# Calculating the mean difference in pay between salaries in 2024 and 2013
pay_diff = mean( clean.dat.24$Salary ) - mean( clean.dat$Salary )
pay_diff

```

\newpage

### Data cleaning for the 2024 dataset to make it comparable to the 2013 dataset.

```{r}
# Converting YrsExp variable in 2024 dataset to numeric, treating "R" as 0 years
# of experience

clean.dat.24 <- clean.dat.24 %>%
  mutate(
    Experience = ifelse(YrsExp == "R", "0", YrsExp),
    Experience= as.numeric(Experience) )

# Cleaning position in 2024 dataset and creating Side variable similar to 2013
# dataset

clean.dat.24 <- clean.dat.24 %>%
  mutate(
    Side = case_when(
      Position %in% c(
        "C", "FB", "OT", "OG", "QB",
        "RB", "TE", "WR", "OL"
      ) ~ "Offense",
      
      Position %in% c(
        "DB", "LB", "DE", "DT", "DL",
        "CB", "NT", "SS", "FS",
        "OLB", "MLB", "ILB", "SAF"
      ) ~ "Defense",
      
      Position %in% c(
        "K", "LS", "P"
      ) ~ "Special Teams",
      
      TRUE ~ NA_character_
    )
  )

# Cleaning position in 2024 dataset so that the positions are similar to 2013
# dataset

clean.dat.position <- clean.dat.24 %>%
  mutate( Position = case_when(
      Position %in% c("OT", "OG", "OL") ~ "OL",
      Position == "C"                   ~ "C",
      Position == "FB"                  ~ "FB",
      Position == "QB"                  ~ "QB",
      Position == "RB"                  ~ "RB",
      Position == "TE"                  ~ "TE",
      Position == "WR"                  ~ "WR",
      Position %in% c("DB", "CB")       ~ "CB",
      Position %in% c("SS", "FS", "SAF") ~ "S",
      Position %in% c("LB", "OLB", "MLB", "ILB") ~ "LB",
      Position %in% c("DT", "DL")       ~ "DL",
      Position == "NT"                  ~ "NT",
      Position == "DE"                  ~ "DE",
      Position == "K"                  ~ "K",
      Position == "P"                  ~ "P",
      Position == "LS"                  ~ "LS",
      TRUE                              ~ NA_character_ ) )

```

## Visualization 1: Plotting Average Salary differences between 2013 and 2024 based on years of experience

To plot the average salary differences, we first create one dataset that has the mean salary for each experience level in both 2013 and 2024, so we can see the mean salary difference between the two years based on experience level.
We then calculate the mean salary difference and percent change between 2013 and 2024 for player experience.

```{r}
# Create dataset with the mean salary for each experience level in both 2013 and 2024
exp.sum <- bind_rows(
  clean.dat %>%
    group_by(Experience) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2013"),
  clean.dat.24 %>%
    group_by(Experience) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2024") )

# Calculate the mean salary difference and percent change between 2013 and 2024
# for player experience
exp.sum %>% 
  group_by( Experience ) %>% 
  summarise( mean_salary_2013 = mean( mean_salary[ year == "2013" ] ), 
             mean_salary_2024 = mean( mean_salary[ year == "2024" ] ) ) %>%
  mutate( salary_diff = mean_salary_2024 - mean_salary_2013 ) %>%
  mutate ( percent_diff = salary_diff / mean_salary_2013 * 100 ) %>%
  arrange( desc( percent_diff ) ) 
```

\newpage

Finally, we plot the average salary differences between 2013 and 2024 based on years of experience.

```{r}
ggplot(exp.sum, aes(x = Experience, y = mean_salary, fill = year)) +
  geom_col(position = "dodge") +
  scale_y_continuous( labels = function(x) x / 1e6,
                     name   = "Average Salary (millions)" ) +
  labs( title = "Average Salary vs Experience in 2013 and 2024",
    x = "Years of Experience" )

```

The first visualization, Average Salary vs Experience in 2013 and 2024, displays a bar chart with the average salary (in millions of USD) on the y-axis and how many years a player has been playing in the league on the x-axis.
Overall, average salaries are higher in 2024 at almost every experience level with players in 2024 making, on average, roughly \$578,365 more per year than players in 2013.
We see two noticeable spikes in this visualization at years 16 and 20 which are due to two quarterbacks, Matthew Stafford and Aaron Rodgers, respectively.
In 2013, there were no players in the NFL playing in years 19 and 20.

To create this first visualization, we first parsed the 2024 CapHit variable to make it comparable to the 2013 Salary variable.
In the 2024 dataset, we turned the years of experience into a numeric variable after converting R to 0 to represent 0 years of experience.
We then combined the 2013 and 2024 dataset into a single dataset, grouped by years of experience, and calculated the average salary for each group.
These averages were then plotted against years of experience for both years.

## Visualization 2: Plotting Average Salary differences between 2013 and 2024 based on side of the ball

Now based on the side of the ball, we create one dataset that has the mean salary for the following sides: offense, defense, special teams, in both 2013 and 2024.
We then calculate the mean salary difference and percent change between those two years.

```{r}
# create dataset with the mean salary for each side of the ball in both 2013 
# and 2024
side.sum <- bind_rows(
  clean.dat %>%
    group_by(Side) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2013"),
  clean.dat.24 %>%
    group_by(Side) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2024") )

# Calculating the mean salary difference and percent change between 2013 and 2024
# for each side of the ball
side.sum %>% 
  group_by( Side ) %>% 
  summarise( mean_salary_2013 = mean( mean_salary[ year == "2013" ] ), 
             mean_salary_2024 = mean( mean_salary[ year == "2024" ] ) ) %>%
  mutate( salary_diff = mean_salary_2024 - mean_salary_2013 ) %>%
  mutate ( percent_diff = salary_diff / mean_salary_2013 * 100 ) %>%
  arrange( desc( percent_diff ) )
```

We plot the average salary differences between 2013 and 2024 based on side of the ball:

```{r}
# Plotting Average Salary differences between 2013 and 2024 based on side
ggplot(side.sum, aes(x = Side, y = mean_salary, fill = year)) +
  geom_col(position = "dodge") +
  scale_y_continuous( labels = function(x) x / 1e6,
                     name   = "Average Salary (millions)" ) +
  labs( title = "Average Salary Difference vs Player Category in 2013 and 2024",
    x = "Player Category" )   

```

The second visualization, Average Salary vs Side of the Ball in 2013 and 2024, displays a bar chart with the average salary (in millions of USD) on the y-axis and the player category (offense, defense, or special teams) on the x-axis.
We see that the average salary for each player category increased from 2013 to 2024, with the largest percent change coming to special teams players at \~34% salary increase.
Offense and defense also increased by \~32% and \~20%, respectively.

To create this second visualization, we classified all of the player positions into three categories for both the 2013 and 2024 datasets.
We then combined the datasets and created a summary dataset, side.sum, and calculated the average salary of each new category.
These averages were then plotted as side-by-side bars for 2013 and 2024.

## Visualization 3: Plotting Average Salary differences between 2013 and 2024 based on position

Now based on position, we create one dataset that has the mean salary for each position in both 2013 and 2024.
And then we calculate the mean salary difference and percent change between those two years for each position.

```{r}
# create dataset with the mean salary for each position in both 2013 and 2024
position.sum <- bind_rows(
  clean.dat %>%
    group_by(Position) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2013"),
  clean.dat.position %>%
    group_by(Position) %>%
    summarise(mean_salary = mean(Salary, na.rm = TRUE) ) %>%
    mutate(year = "2024") )

# Calculating the mean salary difference and percent change between 2013 and 
# 2024 for each position
position.sum %>% 
  group_by( Position ) %>% 
  summarise( mean_salary_2013 = mean( mean_salary[ year == "2013" ] ), 
             mean_salary_2024 = mean( mean_salary[ year == "2024" ] ) ) %>%
  mutate( salary_diff = mean_salary_2024 - mean_salary_2013 ) %>%
  mutate ( percent_diff = salary_diff / mean_salary_2013 * 100 ) %>%
  arrange( desc( percent_diff ) )
```

Finally, we plot the average salary differences between 2013 and 2024 based on position:

```{r}
# Plotting Average Salary differences between 2013 and 2024 based on position
ggplot(position.sum, aes(x = Position, y = mean_salary, fill = year)) +
  geom_col(position = "dodge") +
  scale_y_continuous( labels = function(x) x / 1e6,
                     name   = "Average Salary (millions)" ) +
  labs( title = "Average Salary Difference vs Position in 2013 and 2024",
    x = "Position" )
```

The third visualization, Average Salary vs Position in 2013 and 2024, displays a bar chart with the average salary (in millions of USD) on the y-axis and player position on the x-axis.
We see that the average salary for each position increased from 2013 to 2024.
Most notably, the positions of nosetackle (NT) and quarterback (QB) both see large increases.
Nosetackles increased their average salary from 2013 to 2024 by \~250% followed by quarterbacks at \~67%.
While there are many quarterbacks in the NFL (84 in 2013 and 118 in 2024) there are significantly fewer nosetackles (21 in 2013 and 9 in 2024).
Because there are so few nosetackles, two players' contracts significantly increase the average salary for the position.

To create this third visualization, we had to ensure that all player positions were identical in both 2013 and 2024.
This was done by using the position types in the 2013 dataset as a reference and changing the position types in the 2024 dataset to match via the mutate function.
One more dataset was created, position.sum, which grouped players by position and year and calculated the average salary for each position in 2013 and 2024.
These averages were plotted as side-by-side bars for each year at each position.

\newpage

# Acknowledgements

Copilot and ChatGPT assisted us in this problem set.
Copilot (in R Studio) helped generate some of the code, which we reviewed and adapted.
ChatGPT helped with some troubleshooting of code and football facts.
We did not use generative AI for help with any of the interpretation of the data (though we did use internet research to verify some of the statistics insights, such as what a residuals plot should look like).
